<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾Ù†Ù„ Ú©Ø§Ù†ÙÛŒÚ¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>

<style>
body{
    font-family:tahoma;
    background:#0b132b;
    color:white;
    text-align:center;
    margin:0;
    transition:0.3s;
}

body.light{
    background:#f5f5f5;
    color:#111;
}

h1{margin:20px;}

input{
    width:85%;
    padding:12px;
    border-radius:10px;
    border:none;
    margin:10px;
    font-size:14px;
}

button{
    width:90%;
    padding:15px;
    margin:10px;
    border:none;
    border-radius:10px;
    font-size:16px;
    background:#3a86ff;
    color:white;
}

.toggle-theme{
    width:auto;
    padding:8px 15px;
    background:#222;
}

.guide-btn{
    background:#ffbe0b;
    color:black;
}

.box{
    background:#1c2541;
    margin:10px;
    padding:15px;
    border-radius:15px;
}

body.light .box{background:#fff;}

.config{
    background:#0f1b3d;
    margin:8px 0;
    padding:10px;
    border-radius:10px;
    font-size:12px;
    word-break:break-all;
}

body.light .config{background:#eee;}

.copy{
    margin-top:5px;
    background:#8338ec;
    padding:8px;
    border-radius:8px;
    font-size:12px;
}

.sub{background:#06d6a0;}

.telegram-btn{
    display:block;
    width:85%;
    margin:30px auto;
    padding:15px;
    border-radius:12px;
    background:#229ED9;
    color:white;
    font-size:18px;
    text-decoration:none;
}
</style>
</head>

<body>

<h1>ğŸŒ Ù¾Ù†Ù„ Ú©Ø§Ù†ÙÛŒÚ¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h1>

<button class="toggle-theme" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>

<input type="text" id="search" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ..." oninput="searchData()">

<button onclick="loadConfigs()">ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª</button>

<p id="lastUpdate">â³ Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</p>

<div id="countries">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</div>

<a class="telegram-btn" href="https://t.me/V2raying_config" target="_blank">
ğŸš€ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù…
</a>

<script>
let data = [];
let originalData = [];
let lastUpdateTime = null;

function toggleTheme(){
    document.body.classList.toggle("light");
}

// âœ… ØªØ´Ø®ÛŒØµ Ú©Ø´ÙˆØ± Ø¯Ù‚ÛŒÙ‚ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)
function detectCountry(line){
    const l = line.toLowerCase();

    // ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§
    if(
        l.includes("ğŸ‡ºğŸ‡¸") ||
        l.includes("united states") ||
        l.includes(" us ") ||
        l.includes("-us") ||
        l.includes("_us")
    ){
        return "ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§";
    }

    // ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù† (Ø¯ÛŒÚ¯Ù‡ Ù‚Ø§Ø·ÛŒ Ù†Ù…ÛŒØ´Ù‡)
    if(
        l.includes("ğŸ‡©ğŸ‡ª") ||
        l.includes("germany") ||
        l.includes(" de ") ||
        l.includes("-de") ||
        l.includes("_de")
    ){
        return "ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†";
    }

    return null;
}

async function loadConfigs(){
    document.getElementById("countries").innerHTML="â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...";

    try{
        const res = await fetch("https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge.txt?" + Date.now());

        const lastModified = res.headers.get("Last-Modified");
        lastUpdateTime = lastModified ? new Date(lastModified) : new Date();

        updateClock();

        const text = await res.text();
        const lines = text.split("\n");

        let grouped = {
            "ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§": [],
            "ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†": []
        };

        lines.forEach(line=>{
            const country = detectCountry(line);
            if(country){
                grouped[country].push(line);
            }
        });

        data = [
            {name:"ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§", configs: grouped["ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§"].slice(0,10)},
            {name:"ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†", configs: grouped["ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†"].slice(0,10)}
        ];

        originalData = JSON.parse(JSON.stringify(data));
        showCountries();

    }catch(e){
        document.getElementById("countries").innerHTML="âŒ Ø®Ø·Ø§";
    }
}

// â± Ø¢Ù¾Ø¯ÛŒØª Ø²Ù…Ø§Ù† (Ù‡Ø± Ø¯Ù‚ÛŒÙ‚Ù‡)
setInterval(updateClock, 60000);

function updateClock(){
    if(!lastUpdateTime) return;

    const now = new Date();
    const diff = Math.floor((now - lastUpdateTime) / 1000);

    let text = "";

    if(diff < 60) text = "Ø§Ù„Ø§Ù†";
    else if(diff < 3600) text = Math.floor(diff/60)+" Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´";
    else if(diff < 86400) text = Math.floor(diff/3600)+" Ø³Ø§Ø¹Øª Ù¾ÛŒØ´";
    else text = Math.floor(diff/86400)+" Ø±ÙˆØ² Ù¾ÛŒØ´";

    document.getElementById("lastUpdate").innerText =
        "ğŸ•’ Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: " + text;
}

function showCountries(){
    let html="";

    if(data.every(c => c.configs.length === 0)){
        html = "âŒ Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯";
    }else{
        data.forEach((country,index)=>{
            html+=`
            <div class="box">
                <h3>${country.name} (${country.configs.length})</h3>

                <button onclick="toggleConfigs(${index})">Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</button>
                <button class="sub" onclick="copySub(${index})">ğŸ“¡ Ú©Ù¾ÛŒ Ø³Ø§Ø¨Ø³Ú©Ø±ÛŒÙ¾Ø´Ù†</button>

                <div id="list${index}"></div>
            </div>
            `;
        });
    }

    document.getElementById("countries").innerHTML=html;
}

function toggleConfigs(index){
    let container = document.getElementById("list"+index);

    if(container.innerHTML !== ""){
        container.innerHTML="";
        return;
    }

    let html="";

    data[index].configs.forEach(c=>{
        html+=`
        <div class="config">
            ${c}
            <br>
            <button class="copy" onclick="copyConfig('${c}')">Ú©Ù¾ÛŒ</button>
        </div>
        `;
    });

    container.innerHTML=html;
}

function copyConfig(text){
    navigator.clipboard.writeText(text);
    alert("âœ… Ú©Ù¾ÛŒ Ø´Ø¯");
}

function copySub(index){
    navigator.clipboard.writeText(data[index].configs.join("\n"));
    alert("ğŸ“¡ Ú©Ù¾ÛŒ Ø´Ø¯");
}

function searchData(){
    let value = document.getElementById("search").value.toLowerCase();

    if(!value){
        data = JSON.parse(JSON.stringify(originalData));
        showCountries();
        return;
    }

    data = originalData.map(country=>{
        if(country.name.toLowerCase().includes(value)){
            return country;
        }

        return {
            name: country.name,
            configs: country.configs.filter(c => 
                c.toLowerCase().includes(value)
            )
        };
    });

    showCountries();
}

// â± Ù‡Ø± Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡
setInterval(loadConfigs, 1800000);
loadConfigs();
</script>

</body>
</html>
