<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ú©Ø§Ù†ÙÛŒÚ¯ Ø±Ø§ÛŒÚ¯Ø§Ù†</title>

<style>
body{
    margin:0;
    font-family:sans-serif;
    background:#0b132b;
    color:#fff;
}

.container{
    padding:20px;
    max-width:500px;
    margin:auto;
}

h1{
    text-align:center;
    margin-bottom:20px;
}

input{
    width:100%;
    padding:12px;
    border:none;
    border-radius:20px;
    margin-bottom:15px;
}

button{
    width:100%;
    padding:12px;
    border:none;
    border-radius:20px;
    margin-bottom:10px;
    font-size:16px;
    cursor:pointer;
}

.update{
    background:linear-gradient(45deg,#4facfe,#00f2fe);
}

.country{
    background:linear-gradient(45deg,#ff7e5f,#feb47b);
}

.card{
    background:#1c2541;
    padding:10px;
    border-radius:15px;
    margin-top:10px;
}

.copy{
    background:#6a11cb;
    color:#fff;
    padding:5px 10px;
    border-radius:10px;
    float:left;
}
</style>
</head>

<body>

<div class="container">

<h1>ğŸŒ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</h1>

<input id="search" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ...">

<button class="update" onclick="loadConfigs()">ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª</button>

<div id="lastUpdate"></div>

<div id="countries"></div>

<div id="app"></div>

</div>

<script>
const URL = "https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge_base64.txt";

let data = [];

// â± Ù‡Ø± 1 Ø³Ø§Ø¹Øª Ø¢Ù¾Ø¯ÛŒØª
setInterval(loadConfigs, 3600000);

function iranTime(){
    return new Date().toLocaleString("fa-IR");
}

async function loadConfigs(){
    document.getElementById("app").innerHTML="â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...";
    document.getElementById("countries").innerHTML="";

    try{
        const res = await fetch(URL + "?t=" + Date.now());
        const text = await res.text();
        const decoded = atob(text);

        const lines = decoded.split("\n");
        const unique = [...new Set(lines)];

        const us = unique.filter(c=>c.includes("US"));
        const de = unique.filter(c=>c.includes("DE"));

        data = [
            {name:"ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§", list:us},
            {name:"ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†", list:de}
        ];

        showCountries();

        document.getElementById("lastUpdate").innerText =
        "Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: " + iranTime();

    }catch{
        document.getElementById("app").innerText="âŒ Ø®Ø·Ø§";
    }
}

function showCountries(){
    const box = document.getElementById("countries");

    data.forEach((c,i)=>{
        const btn = document.createElement("button");
        btn.className="country";
        btn.innerText = c.name + " (" + c.list.length + ")";
        btn.onclick = ()=>showConfigs(i);
        box.appendChild(btn);
    });
}

function showConfigs(index){
    const app = document.getElementById("app");
    app.innerHTML="";

    const country = data[index];

    // ğŸ”¥ Ú©Ù¾ÛŒ Ù‡Ù…Ù‡
    const allBtn = document.createElement("button");
    allBtn.innerText="ğŸ“‹ Ú©Ù¾ÛŒ Ù‡Ù…Ù‡";
    allBtn.onclick=()=>{
        navigator.clipboard.writeText(country.list.join("\n"));
        alert("Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
    };
    app.appendChild(allBtn);

    country.list.forEach(cfg=>{
        const div = document.createElement("div");
        div.className="card";

        const text = document.createElement("div");
        text.innerText = cfg;

        const btn = document.createElement("button");
        btn.className="copy";
        btn.innerText="Ú©Ù¾ÛŒ";
        btn.onclick=()=>{
            navigator.clipboard.writeText(cfg);
            alert("Ú©Ù¾ÛŒ Ø´Ø¯");
        };

        div.appendChild(text);
        div.appendChild(btn);

        app.appendChild(div);
    });
}

// Ø³Ø±Ú†
document.getElementById("search").addEventListener("input",function(){
    const val = this.value.toLowerCase();
    const filtered = data.filter(c=>c.name.toLowerCase().includes(val));

    const box = document.getElementById("countries");
    box.innerHTML="";

    filtered.forEach((c,i)=>{
        const btn = document.createElement("button");
        btn.className="country";
        btn.innerText = c.name + " (" + c.list.length + ")";
        btn.onclick = ()=>showConfigs(i);
        box.appendChild(btn);
    });
});

loadConfigs();
</script>

</body>
</html>
