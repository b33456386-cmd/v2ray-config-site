<script>
let data = [];

// Ú¯Ø±ÙØªÙ† Ø²Ù…Ø§Ù† Ø§ÛŒØ±Ø§Ù†
function getIranTime(){
    const now = new Date();
    return now.toLocaleString("fa-IR", {
        timeZone: "Asia/Tehran",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
    });
}

async function loadConfigs(){
    document.getElementById("countries").innerHTML = "Ø¯Ø± Ø­Ø§Ù„ Ù„ÙˆØ¯...";
    document.getElementById("configs").innerHTML = "";

    try{
        const res = await fetch("configs.json?" + Date.now());
        const json = await res.json();

        // ÙÙ‚Ø· Ø¢Ù…Ø±ÛŒÚ©Ø§ Ùˆ Ø¢Ù„Ù…Ø§Ù†
        data = json.countries.filter(c => 
            c.name.includes("Ø¢Ù…Ø±ÛŒÚ©Ø§") || c.name.includes("Ø¢Ù„Ù…Ø§Ù†")
        );

        showCountries();

        // Ù†Ù…Ø§ÛŒØ´ Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª
        showLastUpdate();

    }catch(e){
        document.getElementById("countries").innerHTML = "Ø®Ø·Ø§ âŒ";
    }
}

// Ù†Ù…Ø§ÛŒØ´ Ø²Ù…Ø§Ù† Ø¢Ù¾Ø¯ÛŒØª
function showLastUpdate(){
    let old = document.getElementById("lastUpdate");
    if(old) old.remove();

    const div = document.createElement("div");
    div.id = "lastUpdate";
    div.style.textAlign = "center";
    div.style.marginBottom = "10px";
    div.style.fontSize = "12px";
    div.style.color = "#ccc";

    div.innerText = "Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: " + getIranTime() + " ðŸ‡®ðŸ‡·";

    document.querySelector(".container").prepend(div);
}

function showCountries(){
    const div = document.getElementById("countries");
    div.innerHTML = "";

    data.forEach(c=>{
        const btn = document.createElement("button");
        btn.className = "country";

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ø±Ú†Ù…
        let flag = "";
        if(c.name.includes("Ø¢Ù…Ø±ÛŒÚ©Ø§")) flag = "ðŸ‡ºðŸ‡¸ ";
        if(c.name.includes("Ø¢Ù„Ù…Ø§Ù†")) flag = "ðŸ‡©ðŸ‡ª ";

        btn.innerText = flag + c.name.replace(/ðŸ‡ºðŸ‡¸|ðŸ‡©ðŸ‡ª/g, "") + " ("+c.count+")";

        btn.onclick = ()=> showConfigs(c);
        div.appendChild(btn);
    });
}

function showConfigs(country){
    const div = document.getElementById("configs");
    div.innerHTML = "";

    // Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ù‡Ù…Ù‡
    const allBtn = document.createElement("button");
    allBtn.className = "update";
    allBtn.innerText = "ðŸ“‹ Ú©Ù¾ÛŒ Ù‡Ù…Ù‡";
    allBtn.onclick = ()=>{
        navigator.clipboard.writeText(country.configs.join("\n"));
        alert("Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
    };
    div.appendChild(allBtn);

    country.configs.forEach(c=>{
        const card = document.createElement("div");
        card.className = "card";

        const text = document.createElement("div");
        text.className = "text";
        text.innerText = c;

        const btn = document.createElement("button");
        btn.className = "copy";
        btn.innerText = "Ú©Ù¾ÛŒ";
        btn.onclick = ()=>{
            navigator.clipboard.writeText(c);
            alert("Ú©Ù¾ÛŒ Ø´Ø¯");
        };

        card.appendChild(text);
        card.appendChild(btn);
        div.appendChild(card);
    });
}

// Ù„ÙˆØ¯ Ø§ÙˆÙ„ÛŒÙ‡
loadConfigs();

// Ù‡Ø± Û³ Ø³Ø§Ø¹Øª Ø¢Ù¾Ø¯ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø±
setInterval(loadConfigs, 3 * 60 * 60 * 1000);

</script>
