<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾Ù†Ù„ Ú©Ø§Ù†ÙÛŒÚ¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>

<style>
body{
    font-family:tahoma;
    background:#0b132b;
    color:white;
    text-align:center;
    margin:0;
}
h1{margin:20px;}

input, select{
    width:85%;
    padding:12px;
    border-radius:10px;
    border:none;
    margin:10px;
}

button{
    width:90%;
    padding:15px;
    margin:10px;
    border:none;
    border-radius:10px;
    background:#3a86ff;
    color:white;
}

.guide-btn{
    background:#ffbe0b !important;
    color:black;
}

.guide{
    background:#14213d;
    margin:10px;
    border-radius:15px;
    text-align:right;
    line-height:2;
    max-height:0;
    overflow:hidden;
    transition:0.4s;
}
.guide.open{
    padding:15px;
    max-height:2000px;
}

.box{
    background:#1c2541;
    margin:10px;
    padding:15px;
    border-radius:15px;
}

.config{
    background:#0f1b3d;
    margin:8px 0;
    padding:10px;
    border-radius:10px;
    font-size:12px;
    word-break:break-all;
}

.copy{
    margin-top:5px;
    background:#8338ec;
    padding:6px;
    border-radius:6px;
    font-size:12px;
}

.sub{background:#06d6a0;}
</style>
</head>

<body>

<h1>ğŸŒ Ù¾Ù†Ù„ Ú©Ø§Ù†ÙÛŒÚ¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h1>

<button class="guide-btn" onclick="toggleGuide()">ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§</button>

<div id="guideBox" class="guide">

<b>ğŸ“˜ Ø¢Ù…ÙˆØ²Ø´ Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡:</b><br><br>

1ï¸âƒ£ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ <b>ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª</b> Ø¨Ø²Ù†<br>
2ï¸âƒ£ Ú©Ø´ÙˆØ± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† (ğŸ‡ºğŸ‡¸ ÛŒØ§ ğŸ‡©ğŸ‡ª)<br>
3ï¸âƒ£ Ø±ÙˆÛŒ <b>ğŸ“‚ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</b> Ø¨Ø²Ù†<br>
4ï¸âƒ£ Ú©Ø§Ù†ÙÛŒÚ¯ Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø±Ùˆ <b>Ú©Ù¾ÛŒ</b> Ú©Ù†<br>
5ï¸âƒ£ Ø¯Ø§Ø®Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡ Paste â†’ Connect âœ…<br><br>

<b>ğŸ“¡ Ø³Ø§Ø¨:</b><br>
Ø¨Ø§ Ø¯Ú©Ù…Ù‡ "Ø³Ø§Ø¨" Ù…ÛŒØªÙˆÙ†ÛŒ Ù‡Ù…Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ú©Ø´ÙˆØ± Ø±Ùˆ ÛŒÚ©Ø¬Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒ<br><br>

<b>â± Ø²Ù…Ø§Ù† Ø¢Ù¾Ø¯ÛŒØª:</b><br>
âœ” Ù¾Ù†Ù„ Ù‡Ø± <b>Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡</b> Ø®ÙˆØ¯Ú©Ø§Ø± Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒØ´Ù‡<br>
âœ” Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø§Ù„Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´Ù‡<br><br>

<b>ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†:</b><br>
âœ” Ø§Ú¯Ø± Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯ Ø¨ÛŒØ§Ø¯ØŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡Øª Ø§Ø·Ù„Ø§Ø¹ Ù…ÛŒØ¯Ù‡<br><br>

<b>âš  Ù†Ú©ØªÙ‡:</b><br>
âœ” ÙÙ‚Ø· Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ (US / DE) Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´Ù‡<br>
âœ” Ø§Ú¯Ø± Ú†ÛŒØ²ÛŒ Ù†ÛŒÙˆÙ…Ø¯ØŒ Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø¹Ø¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†<br>

</div>

<input type="text" id="search" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ..." oninput="applyFilters()">

<select id="typeFilter" onchange="applyFilters()">
<option value="all">ğŸŒ Ù‡Ù…Ù‡</option>
<option value="vmess">ğŸŸ£ VMESS</option>
<option value="vless">ğŸŸ¢ VLESS</option>
<option value="ss">âšª SS</option>
<option value="trojan">ğŸ”´ Trojan</option>
</select>

<button onclick="loadConfigs()">ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª</button>

<p id="lastUpdate">â³</p>
<div id="countries">â³</div>

<script>
let data = [];
let originalData = [];
let lastUpdateTime = null;
let lastConfigHash = "";

function toggleGuide(){
    document.getElementById("guideBox").classList.toggle("open");
}

function detectType(c){
    c = c.toLowerCase();
    if(c.startsWith("vmess://")) return "vmess";
    if(c.startsWith("vless://")) return "vless";
    if(c.startsWith("ss://")) return "ss";
    if(c.startsWith("trojan://")) return "trojan";
    return "other";
}

// ØªØ´Ø®ÛŒØµ Ú©Ø´ÙˆØ± Ø¯Ù‚ÛŒÙ‚ + fallback
function detectCountry(c, url){
    let t = c.toLowerCase();

    if(t.includes("us") || t.includes("america") || t.includes("aws")){
        return "US";
    }

    if(t.includes("de") || t.includes("germany") || t.includes("frankfurt")){
        return "DE";
    }

    // fallback Ø§Ø² Ù„ÛŒÙ†Ú©
    if(url.includes("/us/")) return "US";
    if(url.includes("/de/")) return "DE";

    return null;
}

function decodeBase64IfNeeded(text){
    try{
        if(!text.includes("://")){
            return atob(text);
        }
        return text;
    }catch{
        return text;
    }
}

function generateHash(arr){
    return btoa(arr.join("")).slice(0,50);
}

function notifyNewConfigs(){
    if (Notification.permission === "granted"){
        new Notification("ğŸš€ Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯!",{
            body:"Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ ğŸ˜"
        });
    }
}

async function loadConfigs(){
    document.getElementById("countries").innerHTML="â³";

    const urls = [
        "https://raw.githubusercontent.com/soroushmirzaei/telegram-configs-collector/main/countries/us/vless",
        "https://raw.githubusercontent.com/soroushmirzaei/telegram-configs-collector/main/countries/us/vmess",
        "https://raw.githubusercontent.com/soroushmirzaei/telegram-configs-collector/main/countries/de/vless",
        "https://raw.githubusercontent.com/soroushmirzaei/telegram-configs-collector/main/countries/de/vmess"
    ];

    let us = [];
    let de = [];

    for(let u of urls){
        try{
            let r = await fetch(u + "?" + Date.now());
            let t = await r.text();
            t = decodeBase64IfNeeded(t);

            t.split("\n").forEach(l=>{
                let c = l.trim();
                if(!c) return;

                let type = detectType(c);
                if(type === "other") return;
                if(c.length < 20) return;

                let country = detectCountry(c, u);

                if(country === "US") us.push(c);
                if(country === "DE") de.push(c);

            });

        }catch(e){}
    }

    us = [...new Set(us)];
    de = [...new Set(de)];

    let flat = [...us, ...de];
    let newHash = generateHash(flat);

    if(lastConfigHash && newHash !== lastConfigHash){
        notifyNewConfigs();
    }

    lastConfigHash = newHash;

    data = [
        {name:"ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§", configs: us.slice(0,30)},
        {name:"ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†", configs: de.slice(0,30)}
    ];

    originalData = JSON.parse(JSON.stringify(data));

    lastUpdateTime = new Date(); // Ø­Ù„ Ù…Ø´Ú©Ù„ Û°
    updateClock();

    applyFilters();
}

function updateClock(){
    let el = document.getElementById("lastUpdate");

    if(!lastUpdateTime){
        el.innerText="â³";
        return;
    }

    let diff = Math.floor((new Date() - lastUpdateTime)/1000);

    if(diff < 60){
        el.innerText="ğŸ•’ "+diff+" Ø«Ø§Ù†ÛŒÙ‡ Ù¾ÛŒØ´";
    }else if(diff < 3600){
        el.innerText="ğŸ•’ "+Math.floor(diff/60)+" Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´";
    }else{
        el.innerText="ğŸ•’ "+Math.floor(diff/3600)+" Ø³Ø§Ø¹Øª Ù¾ÛŒØ´";
    }
}

setInterval(updateClock,1000);

function applyFilters(){
    let s = document.getElementById("search").value.toLowerCase();
    let type = document.getElementById("typeFilter").value;

    data = originalData.map(c=>{
        let f = c.configs.filter(x=>{
            let m1 = x.toLowerCase().includes(s);
            let m2 = (type==="all") || detectType(x)===type;
            return m1 && m2;
        });

        return {name:c.name, configs:f};
    });

    showCountries();
}

function showCountries(){
    let html="";

    data.forEach((c,i)=>{
        html+=`
        <div class="box">
            <h3>${c.name} (${c.configs.length})</h3>
            <button onclick="toggleConfigs(${i})">ğŸ“‚ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</button>
            <button class="sub" onclick="copySub(${i})">ğŸ“¡ Ø³Ø§Ø¨</button>
            <div id="list${i}"></div>
        </div>`;
    });

    document.getElementById("countries").innerHTML=html;
}

function toggleConfigs(i){
    let el = document.getElementById("list"+i);

    if(el.innerHTML){
        el.innerHTML="";
        return;
    }

    let html="";
    data[i].configs.forEach(c=>{
        html+=`
        <div class="config">
        ${c}
        <button class="copy" onclick="copyConfig('${c}')">Ú©Ù¾ÛŒ</button>
        </div>`;
    });

    el.innerHTML=html;
}

function copyConfig(t){
    navigator.clipboard.writeText(t);
    alert("Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
}

function copySub(i){
    navigator.clipboard.writeText(data[i].configs.join("\n"));
    alert("Ø³Ø§Ø¨ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
}

if (Notification.permission !== "granted"){
    Notification.requestPermission();
}

// Ù‡Ø± Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡
setInterval(loadConfigs,600000);

loadConfigs();
</script>

</body>
</html>
